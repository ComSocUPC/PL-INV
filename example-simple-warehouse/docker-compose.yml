# ğŸ³ Docker Compose - OrquestaciÃ³n Completa del Sistema
# Este archivo permite ejecutar todos los microservicios del almacÃ©n de forma coordinada

version: '3.8'

# ğŸŒ ConfiguraciÃ³n de red para comunicaciÃ³n entre servicios
networks:
  warehouse-network:
    driver: bridge
    name: warehouse-network

# ğŸ’¾ VolÃºmenes para persistencia de datos
volumes:
  auth-data:
    name: warehouse-auth-data
  product-data:
    name: warehouse-product-data
  iot-data:
    name: warehouse-iot-data

services:
  # ğŸšª API Gateway - Puerto de entrada principal (Puerto 3000)
  api-gateway:
    build:
      context: ./api-gateway
      dockerfile: Dockerfile
    container_name: warehouse-api-gateway
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - AUTH_SERVICE_URL=http://auth-service:3001
      - PRODUCT_SERVICE_URL=http://product-service:3002
      - IOT_SERVICE_URL=http://iot-service:3003
    depends_on:
      - auth-service
      - product-service
      - iot-service
    networks:
      - warehouse-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # ğŸ” Auth Service - AutenticaciÃ³n y autorizaciÃ³n (Puerto 3001)
  auth-service:
    build:
      context: ./auth-service
      dockerfile: Dockerfile
    container_name: warehouse-auth-service
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - JWT_SECRET=mi-secreto-ultra-seguro-para-produccion
    volumes:
      - auth-data:/app/data
    networks:
      - warehouse-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # ğŸ›ï¸ Product Service - GestiÃ³n de productos (Puerto 3002)
  product-service:
    build:
      context: ./product-service
      dockerfile: Dockerfile
    container_name: warehouse-product-service
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=production
      - PORT=3002
    volumes:
      - product-data:/app/data
    networks:
      - warehouse-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3002/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # ğŸŒ IoT Service - Dispositivos IoT y sensores (Puerto 3003)
  iot-service:
    build:
      context: ./iot-service
      dockerfile: Dockerfile
    container_name: warehouse-iot-service
    ports:
      - "3003:3003"
    environment:
      - NODE_ENV=production
      - PORT=3003
    volumes:
      - iot-data:/app/data
    networks:
      - warehouse-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3003/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# ğŸ“ InformaciÃ³n para principiantes:
#
# Este archivo Docker Compose define una arquitectura de microservicios completa:
#
# ğŸ—ï¸ ARQUITECTURA:
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚   API Gateway   â”‚â”€â”€â”€â”€â”‚   Auth Service   â”‚
# â”‚   (Puerto 3000) â”‚    â”‚   (Puerto 3001)  â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#           â”‚
#           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#           â”‚             â”‚                 â”‚
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚   Product    â”‚ â”‚      IoT      â”‚ â”‚  Frontend   â”‚
#   â”‚   Service    â”‚ â”‚   Service     â”‚ â”‚  (Futuro)   â”‚
#   â”‚ (Puerto 3002)â”‚ â”‚ (Puerto 3003) â”‚ â”‚             â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# ğŸš€ COMANDOS ÃšTILES:
#
# Iniciar todos los servicios:
# docker-compose up -d
#
# Ver logs de todos los servicios:
# docker-compose logs -f
#
# Ver logs de un servicio especÃ­fico:
# docker-compose logs -f api-gateway
#
# Detener todos los servicios:
# docker-compose down
#
# Reconstruir y reiniciar:
# docker-compose up -d --build
#
# Ver estado de los servicios:
# docker-compose ps
#
# ğŸŒ URLs DEL SISTEMA:
# - API Gateway: http://localhost:3000
# - Auth Service: http://localhost:3001
# - Product Service: http://localhost:3002
# - IoT Service: http://localhost:3003
#
# ğŸ“š DOCUMENTACIÃ“N:
# - API Gateway: http://localhost:3000/api-docs
# - Auth Service: http://localhost:3001/api-docs
# - Product Service: http://localhost:3002/api-docs
# - IoT Service: http://localhost:3003/api-docs
#
# ğŸ”„ COMUNICACIÃ“N:
# - Los servicios se comunican internamente usando los nombres de servicio
# - La red 'warehouse-network' permite comunicaciÃ³n segura entre contenedores
# - Los volÃºmenes persisten los datos de las bases de datos SQLite
#
# ğŸ’¾ PERSISTENCIA:
# - auth-data: Base de datos de usuarios
# - product-data: Base de datos de productos
# - iot-data: Base de datos de dispositivos IoT y lecturas
#
# ğŸ¥ HEALTH CHECKS:
# - Cada servicio tiene verificaciÃ³n automÃ¡tica de salud
# - Docker Compose reinicia automÃ¡ticamente servicios fallidos
# - Dependencias aseguran orden correcto de inicio
#
# Â¡Perfecto para aprender arquitectura de microservicios! ğŸ“
